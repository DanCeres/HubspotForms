<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HubSpot Form Redirect</title>
</head>
<body>
  <h1>Subscribe</h1>

  <div class="hs-form-html" data-region="eu1" data-form-id="151d4e63-52fe-4518-8b7b-1b137af96405" data-portal-id="146384037"></div>

  <!-- HubSpot Form Embed Code (Developer Version) -->
  <script src="https://js-eu1.hsforms.net/forms/embed/developer/146384037.js" defer></script>

  <script>
    // Function to initialize the form listeners
    function initializeHubSpotFormListeners( ) {
      // Check if hbspt.forms is available
      if (window.hbspt && window.hbspt.forms) {
        console.log("HubSpot forms library is ready."); // Log when the library is detected

        window.hbspt.forms.onFormReady = function(form) {
          // Check if this is the form we're interested in
          if (form.portalId === "146384037" && form.formId === "151d4e63-52fe-4518-8b7b-1b137af96405") {
            console.log("HubSpot form ready:", form); // Log the form object

            form.onFormSubmitted(function(event) {
              console.log("Form submitted event:", event); // Log the entire event object

              let email = "";

              // Attempt 1: Get email from event.data (most reliable if available)
              if (event.data && event.data.email) {
                email = encodeURIComponent(event.data.email);
                console.log("Email from event.data:", email);
              } else {
                // Attempt 2: Get email from the form element using common names
                const emailInput = form.querySelector("input[name='email'], input[type='email']");
                if (emailInput && emailInput.value) {
                  email = encodeURIComponent(emailInput.value);
                  console.log("Email from input[name='email'] or input[type='email']:", email);
                } else {
                  // Attempt 3: Iterate through all inputs to find a likely email field
                  const inputs = form.querySelectorAll("input");
                  for (let i = 0; i < inputs.length; i++) {
                    if (inputs[i].value.includes("@") && inputs[i].value.includes(".")) {
                      email = encodeURIComponent(inputs[i].value);
                      console.log("Email found by content scan:", email);
                      break;
                    }
                  }
                }
              }

              if (email) {
                console.log("Redirecting with email:", email);
                setTimeout(function() {
                  window.location.href = `https://danceres.github.io/HubspotForms/confirmationPage2.html?email=${email}`;
                }, 100 );
              } else {
                console.warn("Email not found for redirection. Redirecting without email.");
                // If email is not found, you might still want to redirect
                setTimeout(function() {
                  window.location.href = `https://danceres.github.io/HubspotForms/confirmationPage2.html`;
                }, 100 );
              }
            });
          }
        };
      } else {
        // If hbspt.forms is not yet available, retry after a short delay
        console.log("HubSpot forms library not yet ready, retrying...");
        setTimeout(initializeHubSpotFormListeners, 50); // Retry every 50ms
      }
    }

    // Ensure the DOM is fully loaded before attempting to initialize
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOMContentLoaded fired.");
      initializeHubSpotFormListeners();
    });
  </script>
</body>
</html>
